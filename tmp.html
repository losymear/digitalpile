<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ•°å­—æ¡©è®°å¿†è®­ç»ƒ</title>
    <style>
        /* --- åŸºç¡€æ ·å¼ --- */
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; margin: 0; padding: 20px; background-color: #f8f8f8; color: #333; }
        .container { max-width: 600px; margin: 0 auto; background-color: #fff; padding: 20px; border-radius: 12px; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1); }
        h1 { color: #007aff; font-size: 24px; margin-bottom: 20px; text-align: center; }
        .data-status { text-align: center; font-size: 14px; color: #888; margin-bottom: 30px; }

        /* èœå•æ ·å¼ */
        .menu-list { list-style: none; padding: 0; }
        .menu-item { background-color: #f9f9f9; border: 1px solid #eee; border-radius: 8px; margin-bottom: 10px; padding: 15px; cursor: pointer; transition: background-color 0.2s; }
        .menu-item:hover { background-color: #e5e5e5; }
        .menu-item.disabled { background-color: #f5f5f5; color: #aaa; cursor: not-allowed; opacity: 0.6; } /* ç¦ç”¨æ ·å¼ */
        .menu-item-title { font-weight: bold; font-size: 18px; color: #333; }
        .menu-item.disabled .menu-item-title { color: #aaa; }
        .menu-item-detail { font-size: 14px; color: #888; margin-top: 5px; }
        .menu-item.disabled .menu-item-detail { color: #ccc; }

        /* è§†å›¾åˆ‡æ¢ */
        .current-view { display: none; padding-top: 20px; }
        .current-view.active { display: block; }

        /* è¾“å…¥æ§ä»¶ */
        input[type="number"], input[type="text"], button { padding: 10px; border-radius: 6px; border: 1px solid #ccc; margin-bottom: 15px; width: 100%; box-sizing: border-box; font-size: 16px; }
        .input-group { display: flex; gap: 10px; margin-bottom: 15px; }
        .input-group input { margin-bottom: 0; }

        /* æŒ‰é’® */
        button { background-color: #007aff; color: white; border: none; cursor: pointer; transition: background-color 0.2s; }
        button:disabled { background-color: #ccc; cursor: not-allowed; }
        button:hover:not(:disabled) { background-color: #005bb5; }
        .btn-red { background-color: #ff3b30; }
        .btn-red:hover:not(:disabled) { background-color: #cc2d26; }
        .btn-green { background-color: #34c759; }
        .btn-green:hover:not(:disabled) { background-color: #248a3d; }

        /* ç»“æœå±•ç¤º */
        .result-box { background-color: #f0f8ff; border: 1px solid #cfe2ff; padding: 15px; border-radius: 8px; white-space: pre-wrap; font-size: 16px; margin-bottom: 20px; }
        .result-title { font-weight: bold; font-size: 20px; margin-bottom: 10px; }

        /* è®¾ç½®æ  */
        .setting-bar { display: none; background-color: #fff3cd; border: 1px solid #ffeeba; color: #856404; padding: 10px; border-radius: 6px; margin-bottom: 15px; text-align: center; }
        .setting-content { display: flex; align-items: center; justify-content: center; gap: 8px; }
        .setting-bar input { text-align: center; padding: 5px; margin-bottom: 0; border: 1px solid #ddd; font-size: 14px; }
        .input-short { width: 50px; }
        .input-medium { width: 70px; }
        .setting-bar label { font-weight: bold; font-size: 14px; }

        /* --- é»˜å†™æµ‹è¯•ä¸“å±æ ·å¼ --- */
        .quiz-card { text-align: center; padding: 20px; background: #fff; border: 1px solid #eee; border-radius: 10px; margin-bottom: 20px; }
        .quiz-number { font-size: 60px; font-weight: bold; color: #007aff; display: block; margin: 10px 0; letter-spacing: 2px; }
        .quiz-feedback { padding: 15px; border-radius: 8px; margin-bottom: 15px; text-align: left; display: none; }
        .quiz-correct { background-color: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .quiz-wrong { background-color: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .quiz-info { font-size: 12px; color: #999; margin-bottom: 20px; }

        /* æ–°å¢çš„æ¸…é™¤ç¼“å­˜æŒ‰é’®æ ·å¼ */
        .clear-cache-btn {
            margin-top: 25px;
            background-color: #6c757d; /* ç°è‰² */
            color: white;
            font-size: 14px;
            padding: 8px;
        }
        .clear-cache-btn:hover:not(:disabled) {
            background-color: #5a6268;
        }

        /* æ•…äº‹åˆ—è¡¨æ ·å¼ */
        .story-list { list-style: none; padding: 0; display: grid; grid-template-columns: repeat(auto-fill, minmax(120px, 1fr)); gap: 10px; }
        .story-list-item { background-color: #e6f7ff; border: 1px solid #91d5ff; border-radius: 6px; padding: 10px; text-align: center; cursor: pointer; font-weight: bold; transition: background-color 0.2s; }
        .story-list-item:hover { background-color: #bae7ff; }

        /* æ•…äº‹è¯¦æƒ…æ ·å¼ */
        .story-detail-box { background-color: #f0fff0; border: 1px solid #b7eb8f; padding: 20px; border-radius: 8px; margin-bottom: 20px; }
        .story-detail-box strong { font-size: 24px; color: #389e0d; display: block; margin-bottom: 10px; }
        .story-detail-box p { white-space: pre-wrap; line-height: 1.6; }
    </style>
</head>
<body>
<div class="container">
    <h1 id="main-title">æ•°å­—æ¡©è®°å¿†è®­ç»ƒ</h1>
    <div class="data-status" id="data-status">ç¼–ç : ç¼ºå¤±</div>
    <div class="data-status" id="story-status" style="margin-top: -20px;">æ•…äº‹: ç¼ºå¤±</div>
    <div class="data-status" id="pegs100-status" style="margin-top: -20px;">100æ¡©: ç¼ºå¤±</div>

    <div id="menu-page" class="current-view active">
        <ul class="menu-list">
            <li class="menu-item" onclick="showDrillRangeUI()">
                <div class="menu-item-title">ğŸ§  1. å•æ¬¡éšæœºè®­ç»ƒ (æŸ¥ç¼–ç )</div>
                <div class="menu-item-detail">çœ‹æ•°å­— -> è„‘æµ·è”æƒ³ -> çœ‹ç­”æ¡ˆæ ¸å¯¹</div>
            </li>
            <li class="menu-item" onclick="showQuizRangeUI()">
                <div class="menu-item-title">ğŸ“ 2. é»˜å†™æµ‹è¯• (è¾“ç¼–ç )</div>
                <div class="menu-item-detail">çœ‹æ•°å­— -> è¾“å…¥æ–‡å­— -> ç³»ç»Ÿè‡ªåŠ¨åˆ¤åˆ†</div>
            </li>
            <li class="menu-item" onclick="showInputPage('multi')">
                <div class="menu-item-title">ğŸ”¢ 3. å¤šé‡æ•°å­—è®°å¿†</div>
                <div class="menu-item-detail">ä¸€æ¬¡æ€§è®°å¿† N ä¸ªæ•°å­—</div>
            </li>
            <li class="menu-item" onclick="showInputPage('query')">
                <div class="menu-item-title">ğŸ” 4. æŸ¥è¯¢æ¡©å­ç¼–ç </div>
                <div class="menu-item-detail">æŸ¥æ•°å­—å¯¹åº”çš„ç¼–ç  (000-999)</div>
            </li>
            <li class="menu-item" onclick="showStoryMenuUI()">
                <div class="menu-item-title">ğŸ“– 5. æ•°å­—æ¡©æ•…äº‹æµè§ˆ (æ–°å¢)</div>
                <div class="menu-item-detail">æŸ¥çœ‹ 100-999 æ‰€æœ‰æ•…äº‹</div>
            </li>
            <li class="menu-item pegs100-required" onclick="showPegs100MenuUI()">
                <div class="menu-item-title">ğŸ§® 6. 100 æ•°å­—æ¡©è®­ç»ƒ (00-99)</div>
                <div class="menu-item-detail">è®­ç»ƒ 00 åˆ° 99 çš„æ•°å­—æ¡©</div>
            </li>
        </ul>
        <button class="clear-cache-btn" onclick="clearCacheAndReload()">
            ğŸ”„ æ¸…é™¤ç¼“å­˜å¹¶é‡æ–°åŠ è½½æ•°æ®
        </button>
    </div>

    <div id="story-menu-page" class="current-view">
        <div class="result-title">æ•°å­—æ¡©æ•…äº‹æµè§ˆ</div>
        <ul class="menu-list">
            <li class="menu-item" onclick="showStoryListUI()">
                <div class="menu-item-title">ğŸ“œ æ•…äº‹åˆ—è¡¨ (100-999)</div>
                <div class="menu-item-detail">æŒ‰æ•°å­—æ®µæŸ¥çœ‹æ‰€æœ‰æ•…äº‹</div>
            </li>
            <li class="menu-item" onclick="showRandomStory()">
                <div class="menu-item-title">ğŸ² éšæœºä¸€ä¸ªæ•…äº‹</div>
                <div class="menu-item-detail">å¿«é€ŸæŸ¥çœ‹ä¸€ä¸ªæ•°å­—æ¡©çš„æ•…äº‹</div>
            </li>
            <li class="menu-item" onclick="showInputPage('storyQuery')">
                <div class="menu-item-title">ğŸ” æŸ¥è¯¢æ•…äº‹</div>
                <div class="menu-item-detail">è¾“å…¥æ•°å­—æŸ¥è¯¢å¯¹åº”æ•…äº‹</div>
            </li>
        </ul>
        <button onclick="showMenuUI()">è¿”å›ä¸»èœå•</button>
    </div>

    <div id="story-list-page" class="current-view">
        <div class="result-title">100-999 æ•°å­—æ¡©æ•…äº‹åˆ—è¡¨</div>
        <ul id="story-list-content" class="story-list">
        </ul>
        <button onclick="showStoryMenuUI()">è¿”å›æ•…äº‹èœå•</button>
    </div>

    <div id="pegs100-menu-page" class="current-view">
        <div class="result-title">100 æ•°å­—æ¡©è®­ç»ƒ (00-99)</div>
        <ul class="menu-list">
            <li class="menu-item" onclick="showPegs100ListUI()">
                <div class="menu-item-title">ğŸ“‹ æ¡©å­åˆ—è¡¨ (00-99)</div>
                <div class="menu-item-detail">æŸ¥çœ‹æ‰€æœ‰ 100 ä¸ªæ•°å­—æ¡©</div>
            </li>
            <li class="menu-item" onclick="showRandomPeg100()">
                <div class="menu-item-title">ğŸ² éšæœºä¸€ä¸ªæ¡©å­</div>
                <div class="menu-item-detail">å¿«é€ŸæŸ¥çœ‹ä¸€ä¸ª 00-99 çš„æ•°å­—æ¡©</div>
            </li>
            <li class="menu-item" onclick="showInputPage('pegs100Query')">
                <div class="menu-item-title">ğŸ” æŸ¥è¯¢æ¡©å­</div>
                <div class="menu-item-detail">è¾“å…¥ 00-99 æ•°å­—æŸ¥è¯¢å¯¹åº”æ¡©å­</div>
            </li>
        </ul>
        <button onclick="showMenuUI()">è¿”å›ä¸»èœå•</button>
    </div>

    <div id="pegs100-list-page" class="current-view">
        <div class="result-title">00-99 æ•°å­—æ¡©åˆ—è¡¨</div>
        <div class="result-box" id="pegs100-list-content" style="text-align: left; font-size: 14px;">
        </div>
        <button onclick="showPegs100MenuUI()">è¿”å› 100 æ¡©èœå•</button>
    </div>

    <div id="drill-range-page" class="current-view">
        <div class="result-title">éšæœºè®­ç»ƒ - è®¾å®šèŒƒå›´</div>
        <div style="font-size: 14px; color: #666; margin-bottom: 10px;">è¾“å…¥æ•°å­—èŒƒå›´ (å¦‚ 100-999)</div>
        <div class="input-group">
            <input type="number" id="drill-min" placeholder="æœ€å°å€¼" value="100">
            <span style="align-self: center;">-</span>
            <input type="number" id="drill-max" placeholder="æœ€å¤§å€¼" value="999">
        </div>
        <button onclick="handleDrillStart()">å¼€å§‹è®­ç»ƒ</button>
        <button onclick="showMenuUI()">è¿”å›ä¸»èœå•</button>
    </div>

    <div id="quiz-range-page" class="current-view">
        <div class="result-title">é»˜å†™æµ‹è¯• - è®¾å®šèŒƒå›´</div>
        <div style="font-size: 14px; color: #666; margin-bottom: 10px;">è¾“å…¥æ•°å­—èŒƒå›´ï¼Œç³»ç»Ÿå°†éšæœºå‡ºé¢˜</div>
        <div class="input-group">
            <input type="number" id="quiz-min-setup" placeholder="æœ€å°å€¼" value="100">
            <span style="align-self: center;">-</span>
            <input type="number" id="quiz-max-setup" placeholder="æœ€å¤§å€¼" value="999">
        </div>
        <button onclick="handleQuizStart()">å¼€å§‹æµ‹è¯•</button>
        <button onclick="showMenuUI()">è¿”å›ä¸»èœå•</button>
    </div>

    <div id="quiz-working-page" class="current-view">
        <div class="quiz-card">
            <div class="quiz-info">è¯·é»˜å†™ä¸‹æ–¹æ•°å­—å¯¹åº”çš„æ¡©å­</div>
            <span class="quiz-number" id="quiz-question-num">000</span>
            <div class="quiz-info">(èŒƒå›´: <span id="quiz-range-label"></span>)</div>
        </div>

        <div id="quiz-result-box" class="quiz-feedback"></div>

        <input type="text" id="quiz-answer-input" placeholder="è¾“å…¥æ¡©å­ (å¦‚: è®®æ”¿å…)" onkeydown="if(event.key==='Enter') checkQuizAnswer()">

        <button id="quiz-submit-btn" onclick="checkQuizAnswer()">æäº¤</button>
        <button id="quiz-next-btn" class="btn-green" style="display:none;" onclick="nextQuizRound()">ä¸‹ä¸€ä¸ª</button>
        <button onclick="showMenuUI()" style="margin-top: 10px; background-color: #666;">é€€å‡ºæµ‹è¯•</button>
    </div>

    <div id="input-page" class="current-view">
        <div class="result-title" id="input-page-title"></div>
        <input type="number" id="input-field" placeholder="" oninput="validateInput()">
        <button id="input-submit-btn" onclick="handleInputSubmit()">ç¡®å®š</button>
        <button onclick="showMenuUI()">è¿”å›ä¸»èœå•</button>
    </div>

    <div id="result-page" class="current-view">
        <div class="result-title" id="result-page-title"></div>
        <div class="result-box" id="result-page-content"></div>

        <div id="result-setting-bar" class="setting-bar">
            <div id="setting-multi-content" class="setting-content" style="display:none;">
                <label>ä¸‹è½®æ•°é‡:</label>
                <input type="number" id="next-count-input" class="input-short" min="1" max="20" value="5">
                <span>ä¸ª</span>
            </div>
            <div id="setting-single-content" class="setting-content" style="display:none;">
                <label>èŒƒå›´:</label>
                <input type="number" id="next-min-input" class="input-medium" placeholder="Min">
                <span>-</span>
                <input type="number" id="next-max-input" class="input-medium" placeholder="Max">
            </div>
        </div>

        <button id="result-view-next-btn" class="btn-green" style="display: none;" onclick="handleViewNext()">æŸ¥çœ‹ä¸‹ä¸€ä¸ª ></button>
        <button id="result-next-btn" class="btn-red" onclick="handleResultNext()">ç»§ç»­æ­¤é¡¹æ“ä½œ</button>
        <button onclick="showMenuUI()">è¿”å›ä¸»èœå•</button>
    </div>

</div>

<script>
    // ======================================================
    // æ•°æ®ä¸çŠ¶æ€
    // ======================================================
    const JSON_URL = "https://raw.githubusercontent.com/losymear/cognition/refs/heads/main/files/json/1000code.json";
    const STORY_URL = "https://raw.githubusercontent.com/losymear/cognition/refs/heads/main/files/json/1000story.json"; // æ–°å¢æ•…äº‹æ•°æ®æº
    const CODE100_URL = "https://raw.githubusercontent.com/losymear/cognition/refs/heads/main/files/json/100code.json"; // æ–°å¢ 100 æ¡©æ•°æ®æº
    const CACHE_KEY = "1000code_cache";
    const STORY_CACHE_KEY = "1000story_cache"; // æ–°å¢æ•…äº‹ç¼“å­˜é”®
    const CODE100_CACHE_KEY = "100code_cache"; // æ–°å¢ 100 æ¡©ç¼“å­˜é”®
    const DEFAULT_MIN = 100;
    const DEFAULT_MAX = 999;
    let number_encodings = {};
    let number_stories = {}; // å­˜å‚¨æ•…äº‹æ•°æ®
    let number_pegs100 = {}; // å­˜å‚¨ 100 æ¡©æ•°æ®

    // é¡µé¢å…ƒç´ å¼•ç”¨
    const views = {
        menu: document.getElementById('menu-page'),
        drillRange: document.getElementById('drill-range-page'),
        quizRange: document.getElementById('quiz-range-page'),
        quizWork: document.getElementById('quiz-working-page'),
        input: document.getElementById('input-page'),
        result: document.getElementById('result-page'),
        storyMenu: document.getElementById('story-menu-page'),
        storyList: document.getElementById('story-list-page'),
        pegs100Menu: document.getElementById('pegs100-menu-page'), // æ–°å¢
        pegs100List: document.getElementById('pegs100-list-page'), // æ–°å¢
    };

    // å…¨å±€çŠ¶æ€ (ç”¨äºè®°å½•ä¸Šä¸€æ¬¡çš„èŒƒå›´ï¼Œæ–¹ä¾¿è¿è´¯æ“ä½œ)
    let lastDrillMin = DEFAULT_MIN;
    let lastDrillMax = DEFAULT_MAX;
    let lastQuizMin = DEFAULT_MIN;
    let lastQuizMax = DEFAULT_MAX;

    let currentQuizTargetNum = null; // å½“å‰é»˜å†™æµ‹è¯•çš„æ•°å­—
    let currentPageType = "";
    let nextActionCallback = null;
    let currentQueryNumber = null;
    let currentMultiCount = 5;

    // ======================================================
    // æ ¸å¿ƒå·¥å…·å‡½æ•°
    // ======================================================
    function toast(message) { console.log(message); }

    function hideAllViews() {
        Object.values(views).forEach(el => el.classList.remove('active'));
        // é‡ç½®ä¸€äº›é€šç”¨çš„å­å…ƒç´ æ˜¾ç¤ºçŠ¶æ€
        document.getElementById('result-setting-bar').style.display = 'none';
    }

    function generateRandomNumber(min, max) {
        min = Math.ceil(min);
        max = Math.floor(max);
        const num = Math.floor(Math.random() * (max - min + 1)) + min;

        // æ ¹æ®èŒƒå›´å†³å®šå¡«å……ä½æ•°
        if (max <= 99) {
            return String(num).padStart(2, '0'); // ä¸¤ä½æ•°å­—ï¼Œå¦‚ "00"
        }
        return String(num).padStart(3, '0'); // ä¸‰ä½æ•°å­—ï¼Œå¦‚ "000"
    }

    function getEncoding(numStr) {
        // ç¡®ä¿æŸ¥è¯¢çš„é”®æ˜¯ä¸‰ä½å­—ç¬¦ä¸²ï¼Œä¾‹å¦‚ 99 -> "099"
        const paddedNumStr = String(numStr).padStart(3, '0');
        return number_encodings[paddedNumStr] || `[ç¼ºå¤±]`;
    }

    function getPeg100(numStr) {
        // ç¡®ä¿æŸ¥è¯¢çš„é”®æ˜¯ä¸¤ä½å­—ç¬¦ä¸²ï¼Œä¾‹å¦‚ 9 -> "09"
        const paddedNumStr = String(numStr).padStart(2, '0');
        return number_pegs100[paddedNumStr] || `[ç¼ºå¤±]`;
    }

    function getStory(numStr) {
        // æ•…äº‹æ•°æ®æ˜¯æŒ‰æ®µè½é”®å€¼å¯¹å­˜å‚¨çš„ï¼Œå¦‚ "100-109"
        const num = parseInt(numStr);
        const start = Math.floor(num / 10) * 10;
        const key = `${start}-${start + 9}`;
        const storySegment = number_stories[key] || `[æ•…äº‹æ®µè½ ${key} ç¼ºå¤±]`;

        // æ•…äº‹å†…å®¹æ˜¯å½¢å¦‚ "A(100), B(101)" çš„å­—ç¬¦ä¸²ï¼Œéœ€è¦æå–
        // æˆ‘ä»¬æŸ¥æ‰¾ (æ•°å­—) æ¨¡å¼
        const regex = new RegExp(`([^\\(]+)\\(${num}\\)`);
        const match = storySegment.match(regex);

        if (match) {
            // æ‰¾åˆ°ç²¾ç¡®åŒ¹é… (æ•°å­—) åçš„å‰ä¸€ä¸ªè¯æˆ–çŸ­è¯­
            return `**${match[1].trim()}**\n\nå®Œæ•´æ®µè½:\n${storySegment}`;
        }

        // å¦‚æœæ²¡æœ‰ç²¾ç¡®åŒ¹é…ï¼Œè¿”å›æ•´ä¸ªæ®µè½
        return `**æœªæ‰¾åˆ° ${num} å¯¹åº”çš„ç‹¬ç«‹æ¡©å­ï¼Œè¯·å‚è€ƒä»¥ä¸‹æ®µè½ï¼š**\n\n${storySegment}`;
    }


    function checkDataLoaded() {
        if (!Object.keys(number_encodings).length) {
            alert("âš ï¸ ç¼–ç æ•°æ®æœªåŠ è½½ï¼Œè¯·æ£€æŸ¥ç½‘ç»œ");
            return false;
        }
        return true;
    }

    function checkStoryLoaded() {
        if (!Object.keys(number_stories).length) {
            alert("âš ï¸ æ•…äº‹æ•°æ®æœªåŠ è½½ï¼Œè¯·æ£€æŸ¥ç½‘ç»œ");
            return false;
        }
        return true;
    }

    function checkPegs100Loaded() {
        if (!Object.keys(number_pegs100).length) {
            alert("âš ï¸ 100æ¡©æ•°æ®æœªåŠ è½½ï¼Œè¯·æ£€æŸ¥ç½‘ç»œ");
            return false;
        }
        return true;
    }


    // ======================================================
    // é¡µé¢è·³è½¬é€»è¾‘
    // ======================================================
    function showMenuUI() {
        hideAllViews();
        views.menu.classList.add('active');

        const dataKeys = Object.keys(number_encodings).length;
        const statusText = dataKeys > 0 ? `å·²åŠ è½½ (${dataKeys} æ¡)` : "ç¼ºå¤±";
        document.getElementById('data-status').textContent = `ç¼–ç : ${statusText}`;

        const storyKeys = Object.keys(number_stories).length;
        const storyStatusText = storyKeys > 0 ? `å·²åŠ è½½ (${storyKeys} æ®µ)` : "ç¼ºå¤±";
        document.getElementById('story-status').textContent = `æ•…äº‹: ${storyStatusText}`;

        const pegs100Keys = Object.keys(number_pegs100).length;
        const pegs100StatusText = pegs100Keys > 0 ? `å·²åŠ è½½ (${pegs100Keys} æ¡)` : "ç¼ºå¤±";
        document.getElementById('pegs100-status').textContent = `100æ¡©: ${pegs100StatusText}`;

        // æ£€æŸ¥ 100 æ¡©æ•°æ®æ˜¯å¦åŠ è½½ï¼Œå¦‚æœæ²¡æœ‰ï¼Œåˆ™ç¦ç”¨ç›¸å…³èœå•é¡¹
        const pegs100Loaded = pegs100Keys > 0;
        document.querySelectorAll('.pegs100-required').forEach(el => {
            el.classList.toggle('disabled', !pegs100Loaded);
        });
    }

    // 5. æ•…äº‹èœå•é¡µ
    function showStoryMenuUI() {
        if(!checkStoryLoaded()) return;
        hideAllViews();
        views.storyMenu.classList.add('active');
    }

    // 5. æ•…äº‹åˆ—è¡¨é¡µ
    function showStoryListUI() {
        if(!checkStoryLoaded()) return;
        hideAllViews();
        views.storyList.classList.add('active');
        generateStoryList();
    }

    function generateStoryList() {
        const listEl = document.getElementById('story-list-content');
        listEl.innerHTML = '';

        // å‡è®¾æ•…äº‹é”®æ˜¯ "100-109", "110-119", ..., "990-999"
        const keys = Object.keys(number_stories).sort();

        keys.forEach(key => {
            const li = document.createElement('li');
            li.className = 'story-list-item';
            li.textContent = key;
            li.onclick = () => viewStorySegment(key);
            listEl.appendChild(li);
        });
    }

    function viewStorySegment(key) {
        const storyText = number_stories[key] || `[æ•…äº‹æ®µè½ ${key} ç¼ºå¤±]`;
        // æ˜¾ç¤ºç»“æœæ—¶ï¼Œéœ€è¦å°† (æ•°å­—) æ¨¡å¼æ›¿æ¢ä¸º **(æ•°å­—)** çªå‡ºæ˜¾ç¤º
        const formattedText = storyText.replace(/\((\d{3})\)/g, '($1)').replace(/(\(\d{3}\))/g, ' **$1** ');

        showResult(`ğŸ“˜ ${key} æ•…äº‹æ®µè½`, formattedText, () => showStoryListUI());
        document.getElementById('result-next-btn').textContent = "è¿”å›æ•…äº‹åˆ—è¡¨";
    }

    // 6. 100 æ¡©èœå•é¡µ
    function showPegs100MenuUI() {
        if(!checkPegs100Loaded()) return;
        hideAllViews();
        views.pegs100Menu.classList.add('active');
    }

    // 6. 100 æ¡©åˆ—è¡¨é¡µ
    function showPegs100ListUI() {
        if(!checkPegs100Loaded()) return;
        hideAllViews();
        views.pegs100List.classList.add('active');
        generatePegs100List();
    }

    function generatePegs100List() {
        const listEl = document.getElementById('pegs100-list-content');
        listEl.innerHTML = '';

        const numbers = Object.keys(number_pegs100).sort();
        let content = '';

        numbers.forEach(num => {
            content += `${num}: ${number_pegs100[num]}\n`;
        });

        listEl.textContent = content;
    }


    // 1. å•æ¬¡è®­ç»ƒ - èŒƒå›´é¡µ
    function showDrillRangeUI() {
        if(!checkDataLoaded()) return;
        hideAllViews();
        views.drillRange.classList.add('active');
        document.getElementById('drill-min').value = lastDrillMin;
        document.getElementById('drill-max').value = lastDrillMax;
    }

    // 2. é»˜å†™æµ‹è¯• - èŒƒå›´é¡µ (ç‹¬ç«‹)
    function showQuizRangeUI() {
        if(!checkDataLoaded()) return;
        hideAllViews();
        views.quizRange.classList.add('active');
        document.getElementById('quiz-min-setup').value = lastQuizMin;
        document.getElementById('quiz-max-setup').value = lastQuizMax;
    }

    // 3/4/5/6. é€šç”¨è¾“å…¥é¡µ (å¤šé‡/æŸ¥è¯¢/æ•…äº‹æŸ¥è¯¢/100æ¡©æŸ¥è¯¢)
    function showInputPage(type) {
        if(!checkDataLoaded() && (type !== 'storyQuery' && type !== 'pegs100Query')) return;
        if(type === 'storyQuery' && !checkStoryLoaded()) return;
        if(type === 'pegs100Query' && !checkPegs100Loaded()) return;

        currentPageType = type;
        hideAllViews();
        views.input.classList.add('active');

        const field = document.getElementById('input-field');
        const title = document.getElementById('input-page-title');

        field.value = "";
        field.focus();

        if (type === 'multi') {
            title.textContent = "å¤šé‡è®°å¿† - è¾“å…¥æ•°é‡";
            field.placeholder = "è¯·è¾“å…¥ 1-20";
        } else if (type === 'query') {
            title.textContent = "æŸ¥è¯¢ç¼–ç  - è¾“å…¥æ•°å­—";
            field.placeholder = "è¯·è¾“å…¥æ•°å­— (000-999)";
        } else if (type === 'storyQuery') {
            title.textContent = "æŸ¥è¯¢æ•…äº‹ - è¾“å…¥æ•°å­—";
            field.placeholder = "è¯·è¾“å…¥æ•°å­— (100-999)";
        } else if (type === 'pegs100Query') {
            title.textContent = "æŸ¥è¯¢ 100 æ¡© - è¾“å…¥æ•°å­—";
            field.placeholder = "è¯·è¾“å…¥æ•°å­— (00-99)";
        }
        validateInput();
    }

    // ======================================================
    // ä¸šåŠ¡é€»è¾‘ï¼šæ•…äº‹ç›¸å…³ (Story)
    // ======================================================

    function showRandomStory() {
        if(!checkStoryLoaded()) return;

        // éšæœºä¸€ä¸ª 100-999 çš„æ•°å­—æ¡©
        const randomNum = generateRandomNumber(DEFAULT_MIN, DEFAULT_MAX);

        // æ˜¾ç¤ºæ•…äº‹
        const storyContent = getStory(randomNum);

        showResult(`ğŸ² éšæœºæ•…äº‹: ${randomNum}`, storyContent, showRandomStory);
        document.getElementById('result-next-btn').textContent = "å†æ¥ä¸€ä¸ªéšæœºæ•…äº‹";
    }

    function handleStoryQuery(numStr) {
        const num = parseInt(numStr);
        if(isNaN(num) || num < 100 || num > 999) {
            alert("è¯·è¾“å…¥ 100-999 èŒƒå›´å†…çš„æœ‰æ•ˆæ•°å­—");
            return;
        }

        const storyContent = getStory(num);

        showResult(`ğŸ” æŸ¥è¯¢æ•…äº‹: ${numStr.padStart(3, '0')}`, storyContent, () => showInputPage('storyQuery'));
        document.getElementById('result-next-btn').textContent = "ç»§ç»­æŸ¥è¯¢";
        document.getElementById('result-view-next-btn').style.display = 'block'; // å…è®¸æŸ¥çœ‹ä¸‹ä¸€ä¸ª
        currentQueryNumber = num; // è®¾ç½®å½“å‰æŸ¥è¯¢æ•°å­—ï¼Œæ–¹ä¾¿æŸ¥çœ‹ä¸‹ä¸€ä¸ª
        currentPageType = 'storyQuery'; // ç¡®ä¿ handleViewNext çŸ¥é“å½“å‰æ¨¡å¼
    }

    // ======================================================
    // ä¸šåŠ¡é€»è¾‘ï¼š100 æ¡©ç›¸å…³ (Pegs100)
    // ======================================================
    function showRandomPeg100() {
        if(!checkPegs100Loaded()) return;

        // éšæœºä¸€ä¸ª 00-99 çš„æ•°å­—æ¡©
        const randomNum = generateRandomNumber(0, 99);
        const randomNumStr = String(randomNum).padStart(2, '0');

        // æ˜¾ç¤ºæ¡©å­
        const pegContent = getPeg100(randomNumStr);

        showResult(`ğŸ² éšæœº 100 æ¡©: ${randomNumStr}`, `æ¡©å­: ${pegContent}`, showRandomPeg100);
        document.getElementById('result-next-btn').textContent = "å†æ¥ä¸€ä¸ªéšæœºæ¡©å­";
    }

    function handlePegs100Query(numStr) {
        const num = parseInt(numStr);
        const paddedNumStr = String(num).padStart(2, '0');

        if (isNaN(num) || num < 0 || num > 99) {
            alert("è¯·è¾“å…¥ 00-99 èŒƒå›´å†…çš„æœ‰æ•ˆæ•°å­—");
            return;
        }

        const pegContent = getPeg100(paddedNumStr);

        showResult(`ğŸ” æŸ¥è¯¢ 100 æ¡©: ${paddedNumStr}`, `æ¡©å­: ${pegContent}`, () => showInputPage('pegs100Query'));

        document.getElementById('result-next-btn').textContent = "ç»§ç»­æŸ¥è¯¢";
        document.getElementById('result-view-next-btn').style.display = 'block';
        currentQueryNumber = num;
        currentPageType = 'pegs100Query';
    }

    // ======================================================
    // ä¸šåŠ¡é€»è¾‘ï¼šé»˜å†™æµ‹è¯• (Quiz)
    // ======================================================

    function handleQuizStart() {
        const min = parseInt(document.getElementById('quiz-min-setup').value);
        const max = parseInt(document.getElementById('quiz-max-setup').value);

        if (isNaN(min) || isNaN(max) || min > max) {
            alert("è¯·è¾“å…¥æœ‰æ•ˆçš„èŒƒå›´");
            return;
        }

        // ä¿å­˜çŠ¶æ€
        lastQuizMin = min;
        lastQuizMax = max;

        // è¿›å…¥æµ‹è¯•é¡µ
        hideAllViews();
        views.quizWork.classList.add('active');
        nextQuizRound();
    }

    function nextQuizRound() {
        currentQuizTargetNum = generateRandomNumber(lastQuizMin, lastQuizMax);

        // UI é‡ç½®
        document.getElementById('quiz-question-num').textContent = currentQuizTargetNum;
        document.getElementById('quiz-range-label').textContent = `${lastQuizMin.toString().padStart(3, '0')} - ${lastQuizMax.toString().padStart(3, '0')}`;

        const input = document.getElementById('quiz-answer-input');
        input.value = "";
        input.disabled = false;
        input.focus();

        const feedback = document.getElementById('quiz-result-box');
        feedback.style.display = 'none';
        feedback.className = 'quiz-feedback'; // remove colors

        document.getElementById('quiz-submit-btn').style.display = 'block';
        document.getElementById('quiz-next-btn').style.display = 'none';
    }

    function checkQuizAnswer() {
        const inputEl = document.getElementById('quiz-answer-input');
        const val = inputEl.value.trim();
        if(!val) return;

        const correctString = getEncoding(currentQuizTargetNum); // æ¯”å¦‚ "æ˜“ä¸­å¤©, è®®æ”¿å…"

        // æ¨¡ç³ŠåŒ¹é…ï¼šåˆ†å‰²é€—å·ï¼ˆä¸­è‹±æ–‡ï¼‰æˆ–ç©ºæ ¼
        // æ¯”å¦‚æ ‡å‡†ç­”æ¡ˆæ˜¯ "A, B"ï¼Œç”¨æˆ·è¾“å…¥ "A" æˆ– "B" éƒ½ç®—å¯¹
        const answers = correctString.split(/,|ï¼Œ|\s+/).map(s => s.trim()).filter(s => s);
        const isCorrect = answers.includes(val);

        const feedback = document.getElementById('quiz-result-box');
        feedback.style.display = 'block';

        if (isCorrect) {
            feedback.className = 'quiz-feedback quiz-correct';
            feedback.innerHTML = `<strong>ğŸ‰ å›ç­”æ­£ç¡®ï¼</strong><br>ä½ çš„ç­”æ¡ˆï¼š${val}<br>å®Œæ•´ç¼–ç ï¼š${correctString}`;
        } else {
            feedback.className = 'quiz-feedback quiz-wrong';
            feedback.innerHTML = `<strong>âŒ å›ç­”é”™è¯¯</strong><br>ä½ çš„ç­”æ¡ˆï¼š${val}<br>æ­£ç¡®ç­”æ¡ˆï¼š<strong>${correctString}</strong>`;
        }

        // é”å®šå¹¶æ˜¾ç¤ºä¸‹ä¸€æ­¥
        inputEl.disabled = true;
        document.getElementById('quiz-submit-btn').style.display = 'none';
        const nextBtn = document.getElementById('quiz-next-btn');
        nextBtn.style.display = 'block';
        nextBtn.focus();
    }

    // ======================================================
    // ä¸šåŠ¡é€»è¾‘ï¼šå•æ¬¡éšæœº (Drill)
    // ======================================================
    function handleDrillStart() {
        const min = parseInt(document.getElementById('drill-min').value);
        const max = parseInt(document.getElementById('drill-max').value);

        if (isNaN(min) || isNaN(max) || min > max) { alert("èŒƒå›´æ— æ•ˆ"); return; }

        lastDrillMin = min;
        lastDrillMax = max;

        runDrillLogic(min, max);
    }

    function runDrillLogic(min, max) {
        const target = generateRandomNumber(min, max);
        const answer = getEncoding(target);

        setTimeout(() => {
            const conf = confirm(`ğŸ§  éšæœºæ•°å­—: ${target}\n(èŒƒå›´ ${min.toString().padStart(3, '0')}-${max.toString().padStart(3, '0')})\n\nè¯·è”æƒ³...\nç‚¹å‡»ç¡®å®šæŸ¥çœ‹ç­”æ¡ˆã€‚`);
            if(conf) {
                showResult(`âœ… ${target} çš„ç¼–ç `, `æ•°å­—: ${target}\nç¼–ç : ${answer}`, () => {
                    // ç»­æ¯é€»è¾‘ï¼šé‡æ–°è¯»å–ç»“æœé¡µé¢çš„è®¾ç½®æ¡†
                    const newMin = parseInt(document.getElementById('next-min-input').value);
                    const newMax = parseInt(document.getElementById('next-max-input').value);
                    // ç®€å•æ£€æŸ¥æœ‰æ•ˆæ€§
                    if (!isNaN(newMin) && !isNaN(newMax) && newMin <= newMax) {
                        lastDrillMin = newMin;
                        lastDrillMax = newMax;
                        runDrillLogic(newMin, newMax);
                    } else {
                        // å¦‚æœè®¾ç½®æ— æ•ˆï¼Œå°±ç”¨ä¸Šæ¬¡çš„èŒƒå›´ç»§ç»­
                        runDrillLogic(lastDrillMin, lastDrillMax);
                    }
                });

                // æ˜¾ç¤ºå•æ¬¡è®­ç»ƒä¸“ç”¨çš„è®¾ç½®æ 
                document.getElementById('result-setting-bar').style.display = 'block';
                document.getElementById('setting-single-content').style.display = 'flex';
                document.getElementById('setting-multi-content').style.display = 'none';
                document.getElementById('next-min-input').value = min;
                document.getElementById('next-max-input').value = max;
                document.getElementById('result-next-btn').textContent = "ç»§ç»­æ­¤èŒƒå›´è®­ç»ƒ";

                // å•æ¬¡è®­ç»ƒä¸éœ€è¦æŸ¥çœ‹ä¸‹ä¸€ä¸ªæŒ‰é’®ï¼Œä¿æŒéšè—
                document.getElementById('result-view-next-btn').style.display = 'none';
            } else {
                showMenuUI();
            }
        }, 50);
    }

    // ======================================================
    // ä¸šåŠ¡é€»è¾‘ï¼šå…¶ä»– (Input/Result/Data)
    // ======================================================
    function validateInput() {
        const val = document.getElementById('input-field').value;
        document.getElementById('input-submit-btn').disabled = (val.trim() === "");
    }

    function handleInputSubmit() {
        const val = document.getElementById('input-field').value.trim();
        if (!val) return;

        if (currentPageType === 'multi') {
            const n = parseInt(val);
            if (n > 0 && n <= 20) {
                currentMultiCount = n;
                runMultiLogic(n);
            } else {
                alert("è¯·è¾“å…¥ 1-20");
            }
        } else if (currentPageType === 'query') {
            // æŸ¥è¯¢ç¼–ç 
            if (!/^\d+$/.test(val)) {
                alert("è¯·è¾“å…¥æœ‰æ•ˆçš„æ•°å­— (000-999)");
                return;
            }
            runQueryLogic(val);
        } else if (currentPageType === 'storyQuery') {
            // æŸ¥è¯¢æ•…äº‹
            if (!/^\d+$/.test(val)) {
                alert("è¯·è¾“å…¥æœ‰æ•ˆçš„æ•°å­— (100-999)");
                return;
            }
            handleStoryQuery(val);
        } else if (currentPageType === 'pegs100Query') {
            // æŸ¥è¯¢ 100 æ¡©
            const num = parseInt(val);
            if (isNaN(num) || num < 0 || num > 99) {
                alert("è¯·è¾“å…¥ 00-99 èŒƒå›´å†…çš„æœ‰æ•ˆæ•°å­—");
                return;
            }
            handlePegs100Query(val);
        }
    }

    function runMultiLogic(N) {
        const numbers = [];
        for(let i=0; i<N; i++) numbers.push(generateRandomNumber(DEFAULT_MIN, DEFAULT_MAX)); // å¤šé‡è®°å¿†ä½¿ç”¨é»˜è®¤ 100-999 èŒƒå›´

        const listStr = numbers.join(', ');
        const answerStr = numbers.map(n => `${n}: ${getEncoding(n)}`).join('\n');

        setTimeout(() => {
            const conf = confirm(`è®°å¿† ${N} ä¸ªæ•°å­—:\n${listStr}\n\nå‡†å¤‡å¥½æŸ¥çœ‹ç­”æ¡ˆå—ï¼Ÿ`);
            if(conf) {
                showResult("âœ… å¤šé‡è®°å¿†ç­”æ¡ˆ", `**æ•°å­—:**\n${answerStr}`, () => {
                    const nextN = parseInt(document.getElementById('next-count-input').value);
                    if(nextN > 0 && nextN <= 20) {
                        runMultiLogic(nextN);
                    } else {
                        runMultiLogic(currentMultiCount); // å¦‚æœè®¾ç½®æ— æ•ˆï¼Œç”¨ä¸Šæ¬¡çš„
                    }
                });
                // æ˜¾ç¤ºå¤šé‡ä¸“ç”¨çš„è®¾ç½®æ 
                document.getElementById('result-setting-bar').style.display = 'block';
                document.getElementById('setting-single-content').style.display = 'none';
                document.getElementById('setting-multi-content').style.display = 'flex';
                document.getElementById('next-count-input').value = N;
                document.getElementById('result-next-btn').textContent = "ç»§ç»­ä¸‹ä¸€ç»„æ•°å­—";

            } else {
                showMenuUI();
            }
        }, 50);
    }

    function runQueryLogic(numStr) {
        // å°†è¾“å…¥çš„æ•°å­—å­—ç¬¦ä¸²è½¬æ¢ä¸ºæ•´æ•°ï¼Œå¹¶å­˜å‚¨
        const n = parseInt(numStr);
        currentQueryNumber = n;

        // æŸ¥è¯¢æ—¶ï¼Œä½¿ç”¨ getEncoding å¤„ç†å¡«å…… '0'
        const ans = getEncoding(numStr);

        showResult(`ğŸ” æŸ¥è¯¢: ${numStr.padStart(3, '0')}`, `ç¼–ç : ${ans}`, () => showInputPage('query'));
        document.getElementById('result-view-next-btn').style.display = 'block';
        document.getElementById('result-next-btn').textContent = "ç»§ç»­æŸ¥è¯¢";
        currentPageType = 'query'; // ç¡®ä¿ handleViewNext çŸ¥é“å½“å‰æ¨¡å¼
    }

    function showResult(title, text, nextCallback) {
        hideAllViews();
        views.result.classList.add('active');
        document.getElementById('result-page-title').textContent = title;
        document.getElementById('result-page-content').textContent = text;
        document.getElementById('result-view-next-btn').style.display = 'none'; // reset

        nextActionCallback = nextCallback;
        const btn = document.getElementById('result-next-btn');
        if (nextCallback) {
            btn.style.display = 'block';
            btn.textContent = "ç»§ç»­æ­¤é¡¹æ“ä½œ"; // é»˜è®¤æ–‡æœ¬
        } else {
            btn.style.display = 'none';
        }
    }

    function handleResultNext() {
        if(nextActionCallback) nextActionCallback();
        else showMenuUI();
    }

    function handleViewNext() {
        if (currentQueryNumber === null) return;
        const nextNum = currentQueryNumber + 1;

        if (currentPageType === 'query') {
            // ç¼–ç æŸ¥è¯¢ (000-999)
            runQueryLogic(String(nextNum));
        } else if (currentPageType === 'storyQuery') {
            // æ•…äº‹æŸ¥è¯¢ (100-999)
            if (nextNum > 999) {
                alert("å·²åˆ°è¾¾ 999ï¼Œæ— æ³•æŸ¥è¯¢ä¸‹ä¸€ä¸ªæ•°å­—ã€‚");
                return;
            }
            handleStoryQuery(String(nextNum));
        } else if (currentPageType === 'pegs100Query') {
            // 100æ¡©æŸ¥è¯¢ (00-99)
            if (nextNum > 99) {
                alert("å·²åˆ°è¾¾ 99ï¼Œæ— æ³•æŸ¥è¯¢ä¸‹ä¸€ä¸ªæ•°å­—ã€‚");
                return;
            }
            handlePegs100Query(String(nextNum));
        }
    }

    // ======================================================
    // æ•°æ®åŠ è½½ä¸ç¼“å­˜ (æ ¸å¿ƒåˆå§‹åŒ–é€»è¾‘)
    // ======================================================
    async function initData() {
        // 1. å°è¯•æœ¬åœ°ç¼“å­˜ (ç¼–ç )
        const cachedCode = localStorage.getItem(CACHE_KEY);
        if (cachedCode) {
            try {
                number_encodings = JSON.parse(cachedCode);
                console.log("Loaded code from cache");
            } catch(e) { localStorage.removeItem(CACHE_KEY); }
        }

        // 2. å°è¯•æœ¬åœ°ç¼“å­˜ (æ•…äº‹)
        const cachedStory = localStorage.getItem(STORY_CACHE_KEY);
        if (cachedStory) {
            try {
                number_stories = JSON.parse(cachedStory);
                console.log("Loaded story from cache");
            } catch(e) { localStorage.removeItem(STORY_CACHE_KEY); }
        }

        // 3. å°è¯•æœ¬åœ°ç¼“å­˜ (100 æ¡©)
        const cachedPegs100 = localStorage.getItem(CODE100_CACHE_KEY);
        if (cachedPegs100) {
            try {
                number_pegs100 = JSON.parse(cachedPegs100);
                console.log("Loaded 100 pegs from cache");
            } catch(e) { localStorage.removeItem(CODE100_CACHE_KEY); }
        }

        showMenuUI(); // åˆå§‹æ˜¾ç¤ºèœå•å’ŒçŠ¶æ€

        // 4. è¿œç¨‹æ›´æ–° (ç¼–ç )
        try {
            document.getElementById('data-status').textContent = "ç¼–ç : æ›´æ–°ä¸­...";
            const res = await fetch(JSON_URL);
            const json = await res.json();
            number_encodings = json;
            localStorage.setItem(CACHE_KEY, JSON.stringify(json));
            document.getElementById('data-status').textContent = `ç¼–ç : å·²åŠ è½½ (${Object.keys(json).length} æ¡)`;
        } catch(e) {
            console.error("Failed to load code data:", e);
            const dataKeys = Object.keys(number_encodings).length;
            const statusText = dataKeys > 0 ? `å·²åŠ è½½ (ç¼“å­˜, ${dataKeys} æ¡)` : "åŠ è½½å¤±è´¥";
            document.getElementById('data-status').textContent = `ç¼–ç : ${statusText}`;
        }

        // 5. è¿œç¨‹æ›´æ–° (æ•…äº‹)
        try {
            document.getElementById('story-status').textContent = "æ•…äº‹: æ›´æ–°ä¸­...";
            const res = await fetch(STORY_URL);
            const json = await res.json();
            number_stories = json;
            localStorage.setItem(STORY_CACHE_KEY, JSON.stringify(json));
            document.getElementById('story-status').textContent = `æ•…äº‹: å·²åŠ è½½ (${Object.keys(json).length} æ®µ)`;
        } catch(e) {
            console.error("Failed to load story data:", e);
            const dataKeys = Object.keys(number_stories).length;
            const statusText = dataKeys > 0 ? `å·²åŠ è½½ (ç¼“å­˜, ${dataKeys} æ®µ)` : "åŠ è½½å¤±è´¥";
            document.getElementById('story-status').textContent = `æ•…äº‹: ${statusText}`;
        }

        // 6. è¿œç¨‹æ›´æ–° (100 æ¡©)
        try {
            document.getElementById('pegs100-status').textContent = "100æ¡©: æ›´æ–°ä¸­...";
            const res = await fetch(CODE100_URL);
            const json = await res.json();
            number_pegs100 = json;
            localStorage.setItem(CODE100_CACHE_KEY, JSON.stringify(json));
            document.getElementById('pegs100-status').textContent = `100æ¡©: å·²åŠ è½½ (${Object.keys(json).length} æ¡)`;
        } catch(e) {
            console.error("Failed to load 100 pegs data:", e);
            const dataKeys = Object.keys(number_pegs100).length;
            const statusText = dataKeys > 0 ? `å·²åŠ è½½ (ç¼“å­˜, ${dataKeys} æ¡)` : "åŠ è½½å¤±è´¥";
            document.getElementById('pegs100-status').textContent = `100æ¡©: ${statusText}`;
        }

        // ç¡®ä¿æ›´æ–°çŠ¶æ€åå†æ¬¡åˆ·æ–°èœå•
        showMenuUI();
    }

    function clearCacheAndReload() {
        const confirmed = confirm("ç¡®å®šè¦æ¸…é™¤æœ¬åœ°ç¼“å­˜å¹¶é‡æ–°ä¸‹è½½æ‰€æœ‰æ•°æ®å—ï¼Ÿï¼ˆç”¨äºæ•°æ®æ›´æ–°ï¼‰");
        if (confirmed) {
            localStorage.removeItem(CACHE_KEY);
            localStorage.removeItem(STORY_CACHE_KEY);
            localStorage.removeItem(CODE100_CACHE_KEY); // æ–°å¢æ¸…é™¤ 100 æ¡©ç¼“å­˜
            number_encodings = {};
            number_stories = {};
            number_pegs100 = {}; // æ¸…ç©º 100 æ¡©æ•°æ®
            document.getElementById('data-status').textContent = "ç¼–ç : ç¼“å­˜å·²æ¸…é™¤ï¼Œæ­£åœ¨é‡æ–°åŠ è½½...";
            document.getElementById('story-status').textContent = "æ•…äº‹: ç¼“å­˜å·²æ¸…é™¤ï¼Œæ­£åœ¨é‡æ–°åŠ è½½...";
            document.getElementById('pegs100-status').textContent = "100æ¡©: ç¼“å­˜å·²æ¸…é™¤ï¼Œæ­£åœ¨é‡æ–°åŠ è½½...";
            initData();
        }
    }

    initData();
</script>
</body>
</html>
