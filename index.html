<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ•°å­—æ¡©è®°å¿†è®­ç»ƒ</title>
    <style>
        /* ç®€å•çš„ CSS æ ·å¼ */
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f8f8f8;
            color: #333;
        }
        .container {
            max-width: 600px;
            margin: 0 auto;
            background-color: #fff;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        h1 {
            color: #007aff;
            font-size: 24px;
            margin-bottom: 20px;
            text-align: center;
        }
        .data-status {
            text-align: center;
            font-size: 14px;
            color: #888;
            margin-bottom: 30px;
        }
        .menu-list {
            list-style: none;
            padding: 0;
        }
        .menu-item {
            background-color: #f9f9f9;
            border: 1px solid #eee;
            border-radius: 8px;
            margin-bottom: 10px;
            padding: 15px;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        .menu-item:hover {
            background-color: #e5e5e5;
        }
        .menu-item-title {
            font-weight: bold;
            font-size: 18px;
            color: #333;
        }
        .menu-item-detail {
            font-size: 14px;
            color: #888;
            margin-top: 5px;
        }
        .current-view {
            display: none; /* é»˜è®¤éšè—æ‰€æœ‰åŠŸèƒ½é¡µï¼Œåªæ˜¾ç¤ºèœå• */
            padding-top: 20px;
        }
        .current-view.active {
            display: block;
        }
        input[type="number"], button {
            padding: 10px;
            border-radius: 6px;
            border: 1px solid #ccc;
            margin-bottom: 15px;
            width: 100%;
            box-sizing: border-box;
            font-size: 16px;
        }
        button {
            background-color: #007aff;
            color: white;
            border: none;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        button:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }
        button:hover:not(:disabled) {
            background-color: #005bb5;
        }
        .result-box {
            background-color: #f0f8ff;
            border: 1px solid #cfe2ff;
            padding: 15px;
            border-radius: 8px;
            white-space: pre-wrap;
            font-size: 16px;
            margin-bottom: 20px;
        }
        .result-title {
            font-weight: bold;
            font-size: 20px;
            margin-bottom: 10px;
        }
        .btn-red {
            background-color: #ff3b30;
        }
        .btn-red:hover:not(:disabled) {
            background-color: #cc2d26;
        }
        /* æ–°å¢ï¼šç»¿è‰²æŒ‰é’®æ ·å¼ */
        .btn-green {
            background-color: #34c759;
        }
        .btn-green:hover:not(:disabled) {
            background-color: #248a3d;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 id="main-title">æ•°å­—æ¡©è®°å¿†è®­ç»ƒ</h1>
        <div class="data-status" id="data-status">æ•°æ®: ç¼ºå¤±</div>

        <div id="menu-page" class="current-view active">
            <ul class="menu-list">
                <li class="menu-item" onclick="handleMenuSelect(0)">
                    <div class="menu-item-title">ğŸ§  1. å•æ¬¡éšæœºè®­ç»ƒ</div>
                    <div class="menu-item-detail">éšæœºä¸€ä¸ªæ•°å­—ï¼Œç¡®è®¤åæ˜¾ç¤ºç¼–ç </div>
                </li>
                <li class="menu-item" onclick="handleMenuSelect(1)">
                    <div class="menu-item-title">ğŸ”¢ 2. å¤šé‡æ•°å­—è®°å¿†</div>
                    <div class="menu-item-detail">è¾“å…¥æ•°é‡ Nï¼Œéšæœº N ä¸ªæ•°å­—ç»„è¿›è¡Œè®°å¿†</div>
                </li>
                <li class="menu-item" onclick="handleMenuSelect(2)">
                    <div class="menu-item-title">ğŸ” 3. æŸ¥è¯¢æ¡©å­</div>
                    <div class="menu-item-detail">è¾“å…¥æ•°å­—ï¼Œç«‹å³æ˜¾ç¤ºå¯¹åº”ç¼–ç </div>
                </li>
            </ul>
        </div>

        <div id="input-page" class="current-view">
            <div class="result-title" id="input-page-title"></div>
            <input type="number" id="input-field" placeholder="" oninput="validateInput()">
            <button id="input-submit-btn" onclick="handleInputSubmit()">ç¡®å®š</button>
            <button onclick="showMenuUI()">è¿”å›ä¸»èœå•</button>
        </div>

        <div id="result-page" class="current-view">
            <div class="result-title" id="result-page-title"></div>
            <div class="result-box" id="result-page-content"></div>
            
            <button id="result-view-next-btn" class="btn-green" style="display: none;" onclick="handleViewNext()">æŸ¥çœ‹ä¸‹ä¸€ä¸ª ></button>
            
            <button id="result-next-btn" class="btn-red" onclick="handleResultNext()">ç»§ç»­æ­¤é¡¹æ“ä½œ</button>
            <button onclick="showMenuUI()">è¿”å›ä¸»èœå•</button>
        </div>
    </div>

    <script>
        // ======================================================
        // Web å®ç° JavaScript é€»è¾‘
        // ======================================================

        const JSON_URL = "https://raw.githubusercontent.com/losymear/cognition/refs/heads/main/files/json/1000code.json";
        const CACHE_KEY = "1000code_cache";

        let number_encodings = {};
        const MIN_NUM = 100;
        const MAX_NUM = 999;
        let currentPageType = ""; 
        let nextActionCallback = null; 
        
        // æ–°å¢å˜é‡ï¼šè®°å½•å½“å‰æŸ¥è¯¢åˆ°çš„æ•°å­—
        let currentQueryNumber = null;

        // --- DOM å…ƒç´ å¼•ç”¨ ---
        const menuPage = document.getElementById('menu-page');
        const inputPage = document.getElementById('input-page');
        const resultPage = document.getElementById('result-page');
        const dataStatus = document.getElementById('data-status');
        const mainTitle = document.getElementById('main-title');

        const inputPageTitle = document.getElementById('input-page-title');
        const inputField = document.getElementById('input-field');
        const inputSubmitBtn = document.getElementById('input-submit-btn');

        const resultPageTitle = document.getElementById('result-page-title');
        const resultPageContent = document.getElementById('result-page-content');
        const resultNextBtn = document.getElementById('result-next-btn');
        
        // æ–°å¢å¼•ç”¨
        const resultViewNextBtn = document.getElementById('result-view-next-btn');

        // --- æ ¸å¿ƒè¾…åŠ©å‡½æ•° ---

        function toast(message) {
            console.log("Toast:", message);
        }

        function generateRandomNumber() {
            const randomNumber = Math.floor(Math.random() * (MAX_NUM - MIN_NUM + 1)) + MIN_NUM;
            return String(randomNumber);
        }

        function getEncoding(numStr) {
            return number_encodings[numStr] || `[${numStr} ç¼–ç ç¼ºå¤±!]`;
        }

        // --- ç•Œé¢åˆ‡æ¢é€»è¾‘ ---

        function hideAllViews() {
            menuPage.classList.remove('active');
            inputPage.classList.remove('active');
            resultPage.classList.remove('active');
        }

        function showMenuUI() {
            hideAllViews();
            menuPage.classList.add('active');
            const statusText = Object.keys(number_encodings).length ? "å·²åŠ è½½" : "ç¼ºå¤±";
            mainTitle.textContent = `æ•°å­—æ¡©è®°å¿†è®­ç»ƒ`;
            dataStatus.textContent = `æ•°æ®: ${statusText}`;
        }

        function showInputPage(type) {
            currentPageType = type;
            hideAllViews();
            inputPage.classList.add('active');

            const isMulti = type === "multi";
            const pageTitle = isMulti ? "è¾“å…¥å¤šé‡è®°å¿†æ•°é‡ N" : "è¾“å…¥æŸ¥è¯¢æ•°å­—";
            const placeholder = isMulti ? "è¯·è¾“å…¥æ•°é‡ N (1-20)" : `è¯·è¾“å…¥ ${MIN_NUM} åˆ° ${MAX_NUM} çš„æ•°å­—`;

            inputPageTitle.textContent = pageTitle;
            inputField.placeholder = placeholder;
            inputField.value = "";
            inputField.setAttribute('min', isMulti ? 1 : MIN_NUM);
            inputField.setAttribute('max', isMulti ? 20 : MAX_NUM);
            inputField.focus();
            validateInput();
        }
        
        function validateInput() {
            const input = inputField.value.trim();
            inputSubmitBtn.disabled = input === "";
        }

        function showResultUI(title, message, nextAction) {
            nextActionCallback = nextAction;
            hideAllViews();
            resultPage.classList.add('active');

            resultPageTitle.textContent = title;
            resultPageContent.textContent = message;

            // é»˜è®¤éšè—â€œæŸ¥çœ‹ä¸‹ä¸€ä¸ªâ€ï¼Œåªæœ‰åœ¨æŸ¥è¯¢é€»è¾‘é‡Œæ‰æ‰‹åŠ¨æ‰“å¼€
            resultViewNextBtn.style.display = 'none';

            if (nextAction) {
                resultNextBtn.textContent = "ç»§ç»­æ­¤é¡¹æ“ä½œ";
                resultNextBtn.style.display = 'block';
                resultNextBtn.classList.add('btn-red');
            } else {
                resultNextBtn.style.display = 'none';
            }
        }

        // --- æ ¸å¿ƒåŠŸèƒ½å®ç° ---

        function drillRandomNumber() {
            if (!Object.keys(number_encodings).length) {
                alert("âš ï¸ é”™è¯¯: æ•°æ®æœªåŠ è½½ã€‚");
                return;
            }
            const targetNumber = generateRandomNumber();
            const correctAnswer = getEncoding(targetNumber);

            const userConfirmed = confirm(`ğŸ§  éšæœºæ•°å­—è®­ç»ƒ\n\nè¯·é»˜æƒ³æ•°å­— ${targetNumber} å¯¹åº”çš„ç¼–ç ã€‚å‡†å¤‡å¥½äº†å—ï¼Ÿ\n\nç‚¹å‡»â€œç¡®å®šâ€æŸ¥çœ‹ç¼–ç ï¼Œç‚¹å‡»â€œå–æ¶ˆâ€è¿”å›èœå•ã€‚`);

            if (userConfirmed) {
                showResultUI(`âœ… ${targetNumber} çš„ç¼–ç `,
                    `æ•°å­—: ${targetNumber}\n\nç¼–ç : ${correctAnswer}`,
                    drillRandomNumber);
            } else {
                showMenuUI();
            }
        }

        function drillMultipleNumbers(N) {
            const N_val = parseInt(N);
            const numbers = new Set();
            while (numbers.size < N_val) {
                numbers.add(generateRandomNumber());
            }
            const numberList = Array.from(numbers);
            const formattedList = numberList.map(numStr => `${numStr}: ${getEncoding(numStr)}`).join('\n');
            const plainNumberList = numberList.join(', ');

            const userConfirmed = confirm(`ğŸ§  ${N_val} ä¸ªæ•°å­—éšæœºè®­ç»ƒ\n\nè¯·å°è¯•è”æƒ³å¹¶è®°å¿†è¿™ç»„æ•°å­—ï¼š\n**${plainNumberList}**\n\nå‡†å¤‡å¥½äº†å—ï¼Ÿ\n\nç‚¹å‡»â€œç¡®å®šâ€æŸ¥çœ‹ç­”æ¡ˆï¼Œç‚¹å‡»â€œå–æ¶ˆâ€è¿”å›èœå•ã€‚`);

            if (userConfirmed) {
                showResultUI("âœ… ç¼–ç ç­”æ¡ˆ",
                    `**æ•°å­—åˆ—è¡¨:**\n${formattedList}`,
                    () => showInputPage("multi")
                );
            } else {
                showMenuUI();
            }
        }

        // --- æ–°å¢ï¼šå¤„ç†ç‚¹å‡»â€œæŸ¥çœ‹ä¸‹ä¸€ä¸ªâ€ ---
        function handleViewNext() {
            if (currentQueryNumber === null) return;
            
            // è®¡ç®—ä¸‹ä¸€ä¸ªæ•°å­—
            let nextNum = currentQueryNumber + 1;
            
            // è¾¹ç•Œæ£€æŸ¥
            if (nextNum > MAX_NUM) {
                alert("å·²ç»åˆ°è¾¾æœ€å¤§æ•°å­—ï¼");
                return;
            }
            
            // æ›´æ–°çŠ¶æ€
            currentQueryNumber = nextNum;
            const numStr = String(nextNum);
            const encoding = getEncoding(numStr);
            
            // åˆ·æ–°é¡µé¢æ˜¾ç¤º
            showResultUI(`ğŸ” ${numStr} å¯¹åº”çš„ç¼–ç `,
                `æ•°å­—: ${numStr}\n\nç¼–ç : ${encoding}`,
                () => showInputPage("query")
            );
            
            // é‡è¦ï¼šä¿æŒâ€œæŸ¥çœ‹ä¸‹ä¸€ä¸ªâ€æŒ‰é’®å¯è§
            resultViewNextBtn.style.display = 'block';
        }

        // --- äº‹ä»¶å¤„ç†å‡½æ•° ---

        function handleMenuSelect(index) {
            if (!Object.keys(number_encodings).length) {
                alert("âš ï¸ é”™è¯¯: æ•°æ®æœªåŠ è½½ã€‚");
                return;
            }
            switch (index) {
                case 0: drillRandomNumber(); break;
                case 1: showInputPage("multi"); break;
                case 2: showInputPage("query"); break;
            }
        }

        function handleInputSubmit() {
            const input = inputField.value.trim();
            if (input === "") { toast("è¾“å…¥ä¸èƒ½ä¸ºç©º"); return; }

            if (currentPageType === "multi") {
                const N = parseInt(input);
                if (N > 0 && N <= 20) {
                    drillMultipleNumbers(N);
                } else {
                    alert("é”™è¯¯: è¯·è¾“å…¥ 1 åˆ° 20 ä¹‹é—´çš„æœ‰æ•ˆæ•°å­—ã€‚");
                    showInputPage("multi");
                }
            } else if (currentPageType === "query") {
                const numStr = input;
                const num = parseInt(numStr);
                if (num >= MIN_NUM && num <= MAX_NUM) {
                    // ä¿å­˜å½“å‰æ•°å­—çŠ¶æ€
                    currentQueryNumber = num;
                    
                    const encoding = getEncoding(numStr);
                    showResultUI(`ğŸ” ${numStr} å¯¹åº”çš„ç¼–ç `,
                        `æ•°å­—: ${numStr}\n\nç¼–ç : ${encoding}`,
                        () => showInputPage("query")
                    );
                    
                    // ä»…åœ¨æŸ¥è¯¢æ¨¡å¼ä¸‹ï¼Œæ˜¾ç¤ºâ€œæŸ¥çœ‹ä¸‹ä¸€ä¸ªâ€æŒ‰é’®
                    resultViewNextBtn.style.display = 'block';
                    
                } else {
                    alert(`âš ï¸ æ•°å­—é”™è¯¯: è¯·è¾“å…¥æœ‰æ•ˆçš„ ${MIN_NUM} åˆ° ${MAX_NUM} çš„æ•°å­—ã€‚`);
                    showInputPage("query");
                }
            }
        }

        function handleResultNext() {
            if (nextActionCallback) {
                nextActionCallback();
            } else {
                showMenuUI();
            }
        }

        // --- æ ¸å¿ƒåŠ è½½ä¸æ›´æ–°é€»è¾‘ ---

        function loadFromCache() {
            const jsonStr = localStorage.getItem(CACHE_KEY);
            if (jsonStr) {
                try {
                    number_encodings = JSON.parse(jsonStr);
                    toast("ä½¿ç”¨æœ¬åœ°ç¼“å­˜æ•°æ®ã€‚");
                    return true;
                } catch (e) {
                    localStorage.removeItem(CACHE_KEY);
                    return false;
                }
            }
            return false;
        }

        async function updateFromRemote(isInitialLoad) {
            if (isInitialLoad) dataStatus.textContent = "æ•°æ®: æ­£åœ¨åŠ è½½...";
            try {
                const response = await fetch(JSON_URL);
                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                const newEncodings = await response.json();
                if (JSON.stringify(newEncodings) !== JSON.stringify(number_encodings)) {
                    number_encodings = newEncodings;
                    localStorage.setItem(CACHE_KEY, JSON.stringify(newEncodings));
                    dataStatus.textContent = "æ•°æ®: å·²åŠ è½½";
                }
                return true;
            } catch (error) {
                console.error("åŠ è½½å¤±è´¥:", error);
                if (isInitialLoad && !Object.keys(number_encodings).length) {
                    dataStatus.textContent = "æ•°æ®: ç¼ºå¤±";
                    alert("æ— æ³•åŠ è½½æ•°æ®ï¼Œè¯·æ£€æŸ¥ç½‘ç»œã€‚");
                }
                return false;
            }
        }

        async function init() {
            const cacheLoaded = loadFromCache();
            if (cacheLoaded) {
                showMenuUI();
                await updateFromRemote(false);
            } else {
                await updateFromRemote(true);
                showMenuUI();
            }
        }

        init();
    </script>
</body>
</html>
